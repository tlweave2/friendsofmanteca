<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Available Animals - Friends of Manteca Animal Shelter</title>
    <style>
        /* Global Styles - Matching Index Page */
        :root {
            --primary-color: #df9588;
            --primary-dark: #c57b6d;
            --background-color: #9f9a9a;
            --light-gray: #f5f5f5;
            --white: #ffffff;
            --black: #000000;
            --text-dark: #333333;
            --border-color: #d0d0d0;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            color: var(--text-dark);
            line-height: 1.6;
            background-color: var(--background-color);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        a:hover {
            color: var(--primary-dark);
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            margin: 0.5em 0;
            color: var(--black);
        }
        
        h2 {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        img {
            max-width: 100%;
            height: auto;
        }
        
        /* Header - Matching Index */
        .header {
            background-color: var(--background-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--black);
            gap: 15px;
        }

        .logo-img {
            width: 250px;
            height: 250px;
            object-fit: contain;
            display: block;
        }

        .logo-img-large {
            width: 500px;
            height: 300px;
            object-fit: contain;
            display: block;
        }
        
        .contact-info {
            text-align: right;
            font-size: 0.9rem;
            color: var(--white);
        }
        
        .social-icons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            justify-content: flex-end;
        }
        
        .social-icon {
            width: 35px;
            height: 35px;
            background-color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        
        .social-icon:hover {
            background-color: var(--primary-color);
            color: var(--white);
        }
        
        /* Navigation - Matching Index */
        .nav {
            background-color: var(--black);
        }
        
        .nav-menu {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            margin: 0;
            padding: 0;
        }
        
        .nav-item {
            position: relative;
        }
        
        .nav-link {
            display: block;
            color: var(--white);
            padding: 1rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover,
        .nav-item.active .nav-link {
            background-color: var(--primary-color);
            color: var(--white);
        }
        
        .nav-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: var(--white);
            min-width: 220px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .nav-item:hover .nav-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .nav-dropdown a {
            display: block;
            color: var(--text-dark);
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .nav-dropdown a:hover {
            background-color: var(--light-gray);
            color: var(--primary-color);
        }
        
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }
        
        /* Hero Section - Matching Index */
        .hero {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 4rem 0;
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--white);
        }
        
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background-color: var(--white);
            color: var(--primary-color);
            border-radius: 25px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            border: 2px solid var(--white);
        }
        
        .btn:hover {
            background-color: transparent;
            color: var(--white);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white);
            border: 2px solid var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        /* Section Styling - Matching Index */
        .section {
            background-color: var(--white);
            margin: 2rem 0;
            padding: 3rem 0;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .section-content {
            max-width: 1000px;
            margin: 0 auto;
            text-align: center;
            padding: 0 2rem;
        }

        /* Search Controls */
        .search-controls {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--white);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .search-controls h3 {
            color: var(--white);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .filter-row {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-label {
            font-weight: 600;
            color: var(--white);
            min-width: 60px;
        }

        .filter-select {
            padding: 8px 12px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            min-width: 120px;
            background: var(--white);
            color: var(--text-dark);
        }

        .search-btn {
            padding: 12px 25px;
            background-color: var(--white);
            color: var(--primary-color);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            margin: 0 0.5rem;
        }

        .search-btn:hover {
            background-color: var(--black);
            color: var(--white);
            transform: translateY(-2px);
        }

        /* Animals Grid - Matching Index Style */
        .animals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
            padding: 0 1rem;
        }
        
        .animal-card {
            background: var(--white);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .animal-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }
        
        .animal-image {
            position: relative;
            height: 250px;
            overflow: hidden;
        }
        
        .animal-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .animal-card:hover .animal-image img {
            transform: scale(1.1);
        }
        
        .animal-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary-color);
            color: var(--white);
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .animal-info {
            padding: 2rem;
            text-align: center;
        }
        
        .animal-info h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.4rem;
        }
        
        .animal-meta {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }
        
        .animal-description {
            color: var(--text-dark);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        .animal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .animal-link {
            display: inline-block;
            padding: 12px 25px;
            background: var(--primary-color);
            color: var(--white);
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .animal-link:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            color: var(--white);
        }

        .contact-link {
            background: var(--black);
        }

        .contact-link:hover {
            background: var(--text-dark);
        }
        
        /* Loading and Error States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            font-size: 18px;
            color: #666;
        }
        
        .loading::before {
            content: "";
            width: 30px;
            height: 30px;
            border: 3px solid var(--light-gray);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            border-left: 5px solid #c62828;
        }

        .success-message {
            background-color: #e8f5e8;
            color: #2e7d32;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            border-left: 5px solid #2e7d32;
        }

        .info-message {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #1565c0;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            border-left: 5px solid #1565c0;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .no-results h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        /* Footer - Matching Index */
        .footer {
            background-color: var(--black);
            color: var(--white);
            padding: 3rem 0 1rem;
            margin-top: 3rem;
        }
        
        .footer-content {
            text-align: center;
        }
        
        .footer-social {
            margin-bottom: 2rem;
        }
        
        .footer-info {
            margin-bottom: 2rem;
        }
        
        .footer-info p {
            margin-bottom: 0.5rem;
        }
        
        .footer-bottom {
            border-top: 1px solid #333;
            padding-top: 1rem;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                padding: 1rem 0;
            }
            
            .logo {
                flex-direction: column;
                align-items: center;
                gap: 1px;
            }
            
            .logo-img {
                width: 180px;
                height: 180px;
            }
            
            .logo-img-large {
                width: 200px;
                height: 50px;
            }
            
            .contact-info {
                text-align: center;
            }
            
            .social-icons {
                justify-content: center;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .nav-menu {
                display: none;
                flex-direction: column;
                width: 100%;
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .nav-dropdown {
                position: static;
                opacity: 1;
                visibility: visible;
                transform: none;
                box-shadow: none;
                background-color: var(--light-gray);
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }

            .filter-row {
                flex-direction: column;
                gap: 1rem;
            }

            .filter-group {
                justify-content: space-between;
                width: 100%;
            }

            .animals-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .animal-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="img/fomas.png" alt="Friends of Manteca Animal Shelter Logo" class="logo-img">
                    <img src="img/fomas2.png" alt="Friends of Manteca Animal Shelter Logo" class="logo-img-large">
                </div>
                <div class="contact-info">
                    <div class="social-icons">
                        <a href="mailto:info@fomashelter.org" class="social-icon" title="Email">@</a>
                        <a href="https://facebook.com/fomashelter" class="social-icon" title="Facebook">f</a>
                        <a href="https://instagram.com/fomashelter" class="social-icon" title="Instagram">ig</a>
                    </div>
                    <strong>Mailing Address</strong><br>
                    115 E WETMORE STREET<br>
                    MANTECA, CA 95337
                </div>
            </div>
        </div>
    </header>

   <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <button class="menu-toggle">☰</button>
            <ul class="nav-menu">
                <li class="nav-item active">
                    <a href="index.html" class="nav-link">Home</a>
                </li>
                <li class="nav-item">
                    <a href="animals.html" class="nav-link">Animals</a>
                </li>
                <li class="nav-item">
                    <a href="aboutus.html" class="nav-link">About Us</a>
                    <div class="nav-dropdown">
                        <a href="aboutus.html#mission">Our Mission</a>
                        <a href="aboutus.html#programs">Our Programs</a>
                        <a href="aboutus.html#contact">Contact Us</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="donate.html" class="nav-link">Donate</a>
                </li>
                <li class="nav-item">
                    <a href="events.html" class="nav-link">Events</a>
                </li>
                <li class="nav-item">
                    <a href="contact.html" class="nav-link">Contact</a>
                </li>
            </ul>
        </div>
    </nav>Contact</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Available Animals for Adoption</h1>
            <p>Meet the wonderful animals from Manteca Animal Shelter waiting for their forever homes</p>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container">
        <!-- Animals Section -->
        <section class="section">
            <div class="section-content">
                <h2>Animals from Manteca Animal Shelter</h2>
                
                <!-- Search Controls -->
                <div class="search-controls">
                    <h3>Find Your Perfect Match</h3>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="filter-label">Type:</label>
                            <select class="filter-select" id="animalType">
                                <option value="">All Animals</option>
                                <option value="dog">Dogs</option>
                                <option value="cat">Cats</option>
                                <option value="rabbit">Rabbits</option>
                                <option value="small-furry">Small & Furry</option>
                                <option value="bird">Birds</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Age:</label>
                            <select class="filter-select" id="animalAge">
                                <option value="">Any Age</option>
                                <option value="baby">Baby</option>
                                <option value="young">Young</option>
                                <option value="adult">Adult</option>
                                <option value="senior">Senior</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Size:</label>
                            <select class="filter-select" id="animalSize">
                                <option value="">Any Size</option>
                                <option value="small">Small</option>
                                <option value="medium">Medium</option>
                                <option value="large">Large</option>
                                <option value="xlarge">Extra Large</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-row">
                        <button class="search-btn" onclick="searchMantecaAnimals()">Search Animals</button>
                        <button class="search-btn" onclick="loadAllMantecaAnimals()">Show All Animals</button>
                    </div>
                </div>
                
                <!-- Animals Results -->
                <div id="animals-results">
                    <div class="loading">Connecting to Manteca Animal Shelter...</div>
                </div>
            </div>
        </section>

        <!-- Adoption Process Section -->
        <section class="section">
            <div class="section-content">
                <h2>Our Adoption Process</h2>
                <p style="margin-bottom: 2rem;">Ready to welcome a new family member? Here's how our adoption process works:</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin-top: 2rem;">
                    <div style="text-align: center; padding: 1.5rem;">
                        <div style="width: 60px; height: 60px; background: var(--primary-color); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; margin: 0 auto 1rem;">1</div>
                        <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">Browse Animals</h3>
                        <p>Look through our available dogs and cats to find your perfect match.</p>
                    </div>
                    <div style="text-align: center; padding: 1.5rem;">
                        <div style="width: 60px; height: 60px; background: var(--primary-color); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; margin: 0 auto 1rem;">2</div>
                        <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">Submit Application</h3>
                        <p>Fill out our adoption application for the animal you're interested in.</p>
                    </div>
                    <div style="text-align: center; padding: 1.5rem;">
                        <div style="width: 60px; height: 60px; background: var(--primary-color); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; margin: 0 auto 1rem;">3</div>
                        <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">Meet & Greet</h3>
                        <p>Schedule a visit to meet your potential new family member.</p>
                    </div>
                    <div style="text-align: center; padding: 1.5rem;">
                        <div style="width: 60px; height: 60px; background: var(--primary-color); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; margin: 0 auto 1rem;">4</div>
                        <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">Take Home</h3>
                        <p>Complete the adoption and welcome your new pet home!</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 3rem;">
                    <a href="#" class="btn btn-primary">Download Adoption Application</a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-social">
                    <div class="social-icons" style="justify-content: center;">
                        <a href="#" class="social-icon" title="Email">@</a>
                        <a href="#" class="social-icon" title="Facebook">f</a>
                        <a href="#" class="social-icon" title="Instagram">ig</a>
                    </div>
                </div>
                
                <div class="footer-info">
                    <p><strong>Mailing Address: 115 E WETMORE STREET, MANTECA, CA 95337</strong></p>
                    <p>(FOMAS) Friends of Manteca Animal Shelter is a 501(c)(3) organization that relies on your donations to continue to save companion animals. We are 100% donor supported, and we thank you for helping us make a difference, one animal at a time.</p>
                    <p><strong>Tax ID# 33-3577449</strong></p>
                </div>
                
                <div class="footer-bottom">
                    <p><a href="privacy-policy.html" style="color: var(--primary-color);">Privacy Policy</a> | © 2025 (FOMAS) Friends of Manteca Animal Shelter</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Petfinder API Integration - Focused on Manteca Animal Shelter
        const PETFINDER_API_KEY = 'Nlli1otVftoQhRw1lC1q9OD67Ijxm06P8EqEOGrVxqPCCWkE0X';
        const PETFINDER_API_SECRET = 'DmlsnSz7pUPJFrEjo8KbX1oCY3tEaH5nMmXLrwd6';
        let petfinderAccessToken = null;
        let mantecaShelterId = null;

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            const menuToggle = document.querySelector('.menu-toggle');
            const navMenu = document.querySelector('.nav-menu');
            
            menuToggle.addEventListener('click', function() {
                navMenu.classList.toggle('active');
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.nav')) {
                    navMenu.classList.remove('active');
                }
            });

            // Auto-connect and load Manteca animals
            autoConnectAndLoadAnimals();
        });

        // Auto-connect to Petfinder and load Manteca animals
        async function autoConnectAndLoadAnimals() {
            const resultsDiv = document.getElementById('animals-results');
            
            try {
                // Connect to Petfinder API
                resultsDiv.innerHTML = '<div class="loading">Connecting to Petfinder API...</div>';
                
                const tokenResponse = await fetch('https://api.petfinder.com/v2/oauth2/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `grant_type=client_credentials&client_id=${PETFINDER_API_KEY}&client_secret=${PETFINDER_API_SECRET}`
                });

                if (!tokenResponse.ok) {
                    throw new Error(`Authentication failed: ${tokenResponse.status} ${tokenResponse.statusText}`);
                }

                const tokenData = await tokenResponse.json();
                petfinderAccessToken = tokenData.access_token;

                // Find Manteca Animal Shelter
                resultsDiv.innerHTML = '<div class="loading">Finding Manteca Animal Shelter...</div>';
                await findMantecaShelter();
                
            } catch (error) {
                console.error('Petfinder API connection failed:', error);
                resultsDiv.innerHTML = `
                    <div class="error-message">
                        <h3>❌ Unable to Connect to Petfinder API</h3>
                        <p>We're unable to load animals at this time. This may be due to:</p>
                        <ul style="text-align: left; margin: 15px 0; padding-left: 20px;">
                            <li>Browser CORS restrictions</li>
                            <li>Network connectivity issues</li>
                            <li>Petfinder API temporary outage</li>
                        </ul>
                        <p><strong>Please try refreshing the page or contact us directly for current available animals.</strong></p>
                        <button onclick="autoConnectAndLoadAnimals()" style="margin-top: 15px; padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: bold;">Try Again</button>
                    </div>
                `;
            }
        }

        // Find specific Manteca Animal Shelter
        async function findMantecaShelter() {
            const resultsDiv = document.getElementById('animals-results');
            
            try {
                // Search for organizations using zip code (more reliable)
                resultsDiv.innerHTML = '<div class="loading">Searching for Manteca Animal Shelter organizations...</div>';
                
                const response = await fetch('https://api.petfinder.com/v2/organizations?location=95337&limit=100', {
                    headers: {
                        'Authorization': `Bearer ${petfinderAccessToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    console.error('Organizations search failed:', response.status, response.statusText);
                    
                    if (response.status === 400) {
                        // Try alternative search by state
                        console.log('Zip code failed, trying state search...');
                        const stateResponse = await fetch('https://api.petfinder.com/v2/organizations?state=CA&limit=100', {
                            headers: {
                                'Authorization': `Bearer ${petfinderAccessToken}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (stateResponse.ok) {
                            const stateData = await stateResponse.json();
                            const mantecaShelter = stateData.organizations?.find(org => 
                                org.name.toLowerCase().includes('manteca') ||
                                (org.address && org.address.city && org.address.city.toLowerCase().includes('manteca'))
                            );
                            
                            if (mantecaShelter) {
                                mantecaShelterId = mantecaShelter.id;
                                console.log('Found Manteca shelter via state search:', mantecaShelter.name, 'ID:', mantecaShelter.id);
                                resultsDiv.innerHTML = `
                                    <div class="success-message">
                                        <h3>🏠 Found via CA state search: ${mantecaShelter.name}</h3>
                                        <p>Organization ID: ${mantecaShelter.id}<br>Loading all available animals from this shelter...</p>
                                    </div>
                                `;
                                await loadAllMantecaAnimals();
                                return;
                            }
                        }
                    }
                    
                    throw new Error(`Organizations API returned ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Organizations found:', data.organizations?.length || 0);
                
                if (data.organizations && data.organizations.length > 0) {
                    console.log('Organization names:', data.organizations.map(org => org.name));
                }
                
                // Look for Manteca Animal Shelter specifically - be more precise
                const mantecaShelter = data.organizations?.find(org => {
                    const name = org.name.toLowerCase();
                    
                    // Only match if it specifically mentions "manteca" AND "animal" in the name
                    // OR if it's exactly "city of manteca animal shelter"
                    return (
                        (name.includes('manteca') && name.includes('animal') && name.includes('shelter')) ||
                        name === 'city of manteca animal shelter' ||
                        name === 'manteca animal shelter' ||
                        name.includes('manteca animal services') ||
                        name.includes('manteca municipal animal shelter')
                    );
                });

                if (mantecaShelter) {
                    mantecaShelterId = mantecaShelter.id;
                    console.log('Found Manteca shelter:', mantecaShelter.name, 'ID:', mantecaShelter.id);
                    resultsDiv.innerHTML = `
                        <div class="success-message">
                            <h3>🏠 Connected to: ${mantecaShelter.name}</h3>
                            <p>Organization ID: ${mantecaShelter.id}<br>Loading all available animals from this shelter...</p>
                        </div>
                    `;
                    await loadAllMantecaAnimals();
                } else {
                    console.log('No specific Manteca Animal Shelter found. Available organizations in area:');
                    data.organizations?.forEach(org => {
                        console.log(`- ${org.name} (ID: ${org.id}) - City: ${org.address?.city || 'Unknown'}`);
                    });
                    
                    // Show user what organizations were found so they can see the options
                    const orgList = data.organizations?.slice(0, 10).map(org => 
                        `${org.name} (${org.address?.city || 'Unknown city'})`
                    ).join('<br>') || 'None';
                    
                    resultsDiv.innerHTML = `
                        <div class="info-message">
                            <h3>🔍 No Manteca Animal Shelter Found</h3>
                            <p>Searched ${data.organizations?.length || 0} organizations near zip code 95337.<br>
                            <strong>No organization specifically named "Manteca Animal Shelter" was found.</strong></p>
                            <details style="margin: 15px 0; text-align: left;">
                                <summary style="cursor: pointer; font-weight: bold;">View organizations found (first 10):</summary>
                                <div style="margin-top: 10px; font-size: 0.9em; line-height: 1.6;">
                                    ${orgList}
                                </div>
                            </details>
                            <p><strong>Showing all available animals from the Manteca area instead...</strong></p>
                        </div>
                    `;
                    await loadMantecaAreaAnimals();
                }
                
            } catch (error) {
                console.error('Error in findMantecaShelter:', error);
                
                // Try to proceed with location-based search anyway
                resultsDiv.innerHTML = `
                    <div class="info-message">
                        <h3>⚠️ Organization Search Failed</h3>
                        <p>Unable to search shelter organizations (${error.message}).<br>
                        Trying alternative approach - searching for animals by zip code...</p>
                    </div>
                `;
                
                // Fallback to location-based animal search
                setTimeout(async () => {
                    try {
                        await loadMantecaAreaAnimals();
                    } catch (locationError) {
                        console.error('Location search also failed:', locationError);
                        resultsDiv.innerHTML = `
                            <div class="error-message">
                                <h3>❌ All Search Methods Failed</h3>
                                <p><strong>Organization Search Error:</strong> ${error.message}</p>
                                <p><strong>Location Search Error:</strong> ${locationError.message}</p>
                                <p>This may be due to:</p>
                                <ul style="text-align: left; margin: 15px 0; padding-left: 20px;">
                                    <li>Petfinder API temporary issues</li>
                                    <li>Network connectivity problems</li>
                                    <li>CORS browser restrictions</li>
                                </ul>
                                <p><strong>Please contact us directly at (209) XXX-XXXX for current available animals.</strong></p>
                                <button onclick="autoConnectAndLoadAnimals()" style="margin-top: 15px; padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: bold;">Try Again</button>
                            </div>
                        `;
                    }
                }, 1000);
            }
        }

        // Load all animals from Manteca Animal Shelter specifically
        async function loadAllMantecaAnimals() {
            const resultsDiv = document.getElementById('animals-results');
            resultsDiv.innerHTML = '<div class="loading">Loading all animals from Manteca Animal Shelter...</div>';

            let url;
            if (mantecaShelterId) {
                // Use specific shelter ID
                url = `https://api.petfinder.com/v2/animals?organization=${mantecaShelterId}&limit=50&status=adoptable`;
            } else {
                // Use location-based search
                url = 'https://api.petfinder.com/v2/animals?location=Manteca,CA&distance=5&limit=50&status=adoptable';
            }

            await fetchAndDisplayAnimals(url);
        }

        // Load animals from Manteca area (fallback)
        async function loadMantecaAreaAnimals() {
            const resultsDiv = document.getElementById('animals-results');
            resultsDiv.innerHTML = '<div class="loading">Loading animals from Manteca area...</div>';

            const url = 'https://api.petfinder.com/v2/animals?location=Manteca,CA&distance=10&limit=50&status=adoptable';
            await fetchAndDisplayAnimals(url);
        }

        // Search animals with filters
        async function searchMantecaAnimals() {
            if (!petfinderAccessToken) {
                const resultsDiv = document.getElementById('animals-results');
                resultsDiv.innerHTML = `
                    <div class="error-message">
                        <h3>⚠️ API Not Connected</h3>
                        <p>Please ensure the Petfinder API connection is established first.</p>
                        <button onclick="autoConnectAndLoadAnimals()" style="margin-top: 15px; padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: bold;">Connect to API</button>
                    </div>
                `;
                return;
            }

            const resultsDiv = document.getElementById('animals-results');
            resultsDiv.innerHTML = '<div class="loading">Searching animals...</div>';

            // Get filter values
            const type = document.getElementById('animalType').value;
            const age = document.getElementById('animalAge').value;
            const size = document.getElementById('animalSize').value;

            // Build search URL using proper API format
            let url = 'https://api.petfinder.com/v2/animals?';
            let params = [];

            // Use organization if we have it, otherwise use location
            if (mantecaShelterId) {
                params.push(`organization=${mantecaShelterId}`);
            } else {
                // Use zip code format - most reliable for API
                params.push('location=95337');
                params.push('distance=25');
            }

            // Add filters only if they have values
            if (type) params.push(`type=${type}`);
            if (age) params.push(`age=${age}`);
            if (size) params.push(`size=${size}`);
            
            // Always add these
            params.push('status=adoptable');
            params.push('limit=50');

            url += params.join('&');
            console.log('Search URL:', url);
            
            await fetchAndDisplayAnimals(url, 'filtered search');
        }

        // Fetch and display animals
        async function fetchAndDisplayAnimals(url, searchType = 'search') {
            const resultsDiv = document.getElementById('animals-results');
            
            try {
                console.log(`Starting ${searchType} with URL:`, url);
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${petfinderAccessToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                if (!response.ok) {
                    // Get the error details from the response
                    const errorData = await response.text();
                    console.error('Error response:', errorData);
                    
                    let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    let errorDetails = '';
                    
                    try {
                        const parsedError = JSON.parse(errorData);
                        if (parsedError.detail) {
                            errorDetails += `<br><strong>Details:</strong> ${parsedError.detail}`;
                        }
                        if (parsedError['invalid-params']) {
                            errorDetails += '<br><strong>Invalid Parameters:</strong><ul style="text-align: left; margin: 10px 0; padding-left: 20px;">';
                            parsedError['invalid-params'].forEach(param => {
                                errorDetails += `<li>${param.path}: ${param.message}</li>`;
                            });
                            errorDetails += '</ul>';
                        }
                    } catch (e) {
                        console.log('Could not parse error response as JSON');
                    }
                    
                    // Try a simpler API call as fallback
                    if (searchType !== 'simple fallback') {
                        console.log('Trying simple fallback approach...');
                        resultsDiv.innerHTML = `
                            <div class="info-message">
                                <h3>🔄 Parameter Error Detected</h3>
                                <p>The detailed search failed: ${errorMessage}${errorDetails}</p>
                                <p>Trying a simpler search approach...</p>
                            </div>
                        `;
                        
                        // Try just basic location search without extra parameters
                        const simpleUrl = 'https://api.petfinder.com/v2/animals?location=95337&limit=20';
                        setTimeout(() => fetchAndDisplayAnimals(simpleUrl, 'simple fallback'), 1000);
                        return;
                    }
                    
                    throw new Error(`${errorMessage}${errorDetails}`);
                }

                const data = await response.json();
                console.log('API Response data:', data);
                
                if (!data.animals || data.animals.length === 0) {
                    resultsDiv.innerHTML = `
                        <div class="no-results">
                            <h3>No Animals Found</h3>
                            <p>No animals match your search criteria in the Manteca area.</p>
                            <p>Search details: ${searchType}</p>
                            <p>Try adjusting your filters or check back later for new arrivals.</p>
                        </div>
                    `;
                    return;
                }

                console.log(`Found ${data.animals.length} animals`);
                displayAnimals(data.animals);
                
            } catch (error) {
                console.error('Error in fetchAndDisplayAnimals:', error);
                resultsDiv.innerHTML = `
                    <div class="error-message">
                        <h3>❌ Failed to Load Animals</h3>
                        <p><strong>Search Type:</strong> ${searchType}</p>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>URL Attempted:</strong> ${url}</p>
                        <p>This may be due to:</p>
                        <ul style="text-align: left; margin: 15px 0; padding-left: 20px;">
                            <li>Invalid search parameters</li>
                            <li>API rate limiting</li>
                            <li>Network connectivity issues</li>
                            <li>CORS browser restrictions</li>
                        </ul>
                        <p><strong>Please contact us directly for current available animals.</strong></p>
                        <button onclick="autoConnectAndLoadAnimals()" style="margin-top: 15px; padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: bold;">Try Again</button>
                    </div>
                `;
            }
        }

        // Display animals in grid
        function displayAnimals(animals) {
            const resultsDiv = document.getElementById('animals-results');
            
            let html = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <p style="color: var(--primary-color); font-weight: bold; font-size: 1.1rem;">
                        Found ${animals.length} animals available for adoption
                    </p>
                </div>
                <div class="animals-grid">
            `;
            
            animals.forEach(animal => {
                const hasPhoto = animal.photos && animal.photos.length > 0;
                const photo = hasPhoto ? (animal.photos[0].large || animal.photos[0].medium || animal.photos[0].small) : null;
                
                const breed = animal.breeds.primary + (animal.breeds.secondary ? ` / ${animal.breeds.secondary}` : '');
                const description = animal.description ? 
                    (animal.description.length > 120 ? animal.description.substring(0, 120) + '...' : animal.description)
                    : `${animal.name} is a wonderful ${animal.type.toLowerCase()} looking for a loving home.`;

                html += `
                    <div class="animal-card">
                        <div class="animal-image">
                            ${hasPhoto ? 
                                `<img src="${photo}" alt="${animal.name}">` : 
                                `<div style="width: 100%; height: 100%; background: var(--light-gray); display: flex; align-items: center; justify-content: center; color: #999; font-size: 1.2rem;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">${animal.type === 'Dog' ? '🐕' : animal.type === 'Cat' ? '🐱' : '🐾'}</div>
                                        <div>No Photo Available</div>
                                    </div>
                                </div>`
                            }
                            <div class="animal-badge">${animal.status}</div>
                        </div>
                        <div class="animal-info">
                            <h3>${animal.name}</h3>
                            <div class="animal-meta">
                                <div class="meta-item">
                                    <span>${animal.type === 'Dog' ? '🐕' : animal.type === 'Cat' ? '🐱' : '🐾'} ${breed}</span>
                                </div>
                                <div class="meta-item">
                                    <span>${animal.gender === 'Male' ? '♂' : '♀'} ${animal.gender}</span>
                                </div>
                                <div class="meta-item">
                                    <span>🎂 ${animal.age}</span>
                                </div>
                                ${animal.size ? `<div class="meta-item"><span>📏 ${animal.size}</span></div>` : ''}
                            </div>
                            <p class="animal-description">${description}</p>
                            <div class="animal-actions">
                                <a href="${animal.url}" target="_blank" class="animal-link">View Details</a>
                                ${animal.contact.email ? `<a href="mailto:${animal.contact.email}?subject=Interested in ${animal.name}" class="animal-link contact-link">Contact Shelter</a>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }

        // Show demo animals as fallback
        function showDemoAnimals() {
            const resultsDiv = document.getElementById('animals-results');
            
            const demoAnimals = [
                {
                    name: "Max",
                    type: "Dog",
                    breeds: { primary: "Labrador Retriever", secondary: null },
                    age: "Adult",
                    gender: "Male",
                    size: "Large",
                    photos: [{ large: "https://images.unsplash.com/photo-1551717743-49959800b1f6?w=400&h=300&fit=crop" }],
                    description: "Max is a friendly and energetic Labrador who loves playing fetch and long walks. He's great with kids and other dogs!",
                    contact: { email: "adopt@mantecaanimalshelter.org" },
                    url: "#",
                    status: "adoptable"
                },
                {
                    name: "Luna",
                    type: "Cat",
                    breeds: { primary: "Domestic Shorthair", secondary: null },
                    age: "Young",
                    gender: "Female",
                    size: "Medium",
                    photos: [{ large: "https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=400&h=300&fit=crop" }],
                    description: "Luna is a sweet and playful cat who loves to cuddle and chase toy mice. She's litter trained and great with other cats.",
                    contact: { email: "adopt@mantecaanimalshelter.org" },
                    url: "#",
                    status: "adoptable"
                },
                {
                    name: "Charlie",
                    type: "Dog",
                    breeds: { primary: "German Shepherd", secondary: "Mix" },
                    age: "Adult",
                    gender: "Male",
                    size: "Large",
                    photos: [{ large: "https://images.unsplash.com/photo-1605568427561-40dd23c2acea?w=400&h=300&fit=crop" }],
                    description: "Charlie is a loyal and intelligent dog who would make a great companion for an active family. He knows basic commands.",
                    contact: { email: "adopt@mantecaanimalshelter.org" },
                    url: "#",
                    status: "adoptable"
                },
                {
                    name: "Bella",
                    type: "Cat",
                    breeds: { primary: "Calico", secondary: null },
                    age: "Adult",
                    gender: "Female",
                    size: "Medium",
                    photos: [{ large: "https://images.unsplash.com/photo-1573865526739-10659fec78a5?w=400&h=300&fit=crop" }],
                    description: "Bella is a gentle and loving cat who enjoys peaceful environments and sunny windowsills. Perfect lap cat!",
                    contact: { email: "adopt@mantecaanimalshelter.org" },
                    url: "#",
                    status: "adoptable"
                },
                {
                    name: "Rocky",
                    type: "Dog",
                    breeds: { primary: "Pit Bull Terrier", secondary: null },
                    age: "Adult",
                    gender: "Male",
                    size: "Large",
                    photos: [{ large: "https://images.unsplash.com/photo-1583337130417-3346a1be7dee?w=400&h=300&fit=crop" }],
                    description: "Rocky is a loyal and affectionate dog who loves people. He's well-trained and would make a great family companion.",
                    contact: { email: "adopt@mantecaanimalshelter.org" },
                    url: "#",
                    status: "adoptable"
                },
                {
                    name: "Daisy",
                    type: "Dog",
                    breeds: { primary: "Beagle", secondary: null },
                    age: "Senior",
                    gender: "Female",
                    size: "Medium",
                    photos: [{ large: "https://images.unsplash.com/photo-1518717758536-85ae29035b6d?w=400&h=300&fit=crop" }],
                    description: "Daisy is a friendly and curious Beagle who loves to explore. She gets along well with other dogs and loves treats!",
                    contact: { email: "adopt@mantecaanimalshelter.org" },
                    url: "#",
                    status: "adoptable"
                }
            ];

            resultsDiv.innerHTML = `
                <div class="info-message">
                    <h3>🌟 Demo Animals from Manteca Animal Shelter</h3>
                    <p>The Petfinder API is currently unavailable due to browser restrictions.<br>
                    These sample animals show how the integration would look with live data.</p>
                </div>
            `;
            
            displayAnimals(demoAnimals);
        }
    </script>
</body>
</html>